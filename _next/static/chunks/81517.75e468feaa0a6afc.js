"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[81517],{73853:function(t,e,r){r.d(e,{D:function(){return m},F:function(){return d},I:function(){return c},a:function(){return l},b:function(){return h},c:function(){return u},f:function(){return p},g:function(){return f},u:function(){return g}});var a=r(15418),i=r(46347),n=r(61501),o=r(8400),s=r(23663).Buffer;let c=i.arrayify("0x80ac58cd"),l=i.arrayify("0xd9b67a26"),d={name:"Failed to load NFT metadata"};async function p(t,e,r){let o;if(e.startsWith("data:application/json;base64")&&void 0!==s){let r=e.split(",")[1],i=JSON.parse(s.from(r,"base64").toString("utf-8"));return a.a.parse({...i,id:n.O$.from(t).toString(),uri:e})}let c=e.replace("{id}",i.hexZeroPad(n.O$.from(t).toHexString(),32).slice(2));try{o=await r.downloadJSON(c)}catch(i){let a=e.replace("{id}",n.O$.from(t).toString());try{o=await r.downloadJSON(a)}catch(r){console.warn("failed to get token metadata: ".concat(JSON.stringify({tokenId:t.toString(),tokenUri:e})," -- falling back to default metadata")),o=d}}return a.a.parse({...o,id:n.O$.from(t).toString(),uri:e})}async function u(t,e,i,s){let u;let h=(await r.e(31787).then(r.t.bind(r,31787,19))).default,g=new o.CH(t,h,e),[f,m]=await Promise.all([g.supportsInterface(c),g.supportsInterface(l)]);if(f){let a=(await Promise.resolve().then(r.t.bind(r,19115,19))).default,n=new o.CH(t,a,e);u=await n.tokenURI(i)}else if(m){let a=(await Promise.resolve().then(r.t.bind(r,31617,19))).default,n=new o.CH(t,a,e);u=await n.uri(i)}else throw Error("Contract must implement ERC 1155 or ERC 721.");return u?p(i,u,s):a.a.parse({...d,id:n.O$.from(i).toString(),uri:""})}async function h(t,e){return"string"==typeof t?t:await e.upload(a.C.parse(t))}async function g(t,e,r,i){if(void 0===t.find(t=>"string"!=typeof t))return t;if(void 0===t.find(t=>"object"!=typeof t))return await e.uploadBatch(t.map(t=>a.C.parse(t)),{rewriteFileNames:{fileStartNumber:r||0},onProgress:null==i?void 0:i.onProgress});throw Error("NFT metadatas must all be of the same type (all URI or all NFTMetadataInput)")}function f(t){let e=t[0].substring(0,t[0].lastIndexOf("/"));for(let r=0;r<t.length;r++){let a=t[r].substring(0,t[r].lastIndexOf("/"));if(e!==a)throw Error("Can only create batches with the same base URI for every entry in the batch. Expected '".concat(e,"' but got '").concat(a,"'"))}return e.replace(/\/$/,"")+"/"}let m=100},36079:function(t,e,r){r.d(e,{c:function(){return n}});var a=r(89586),i=r(12158);function n(t){return(0,i.i)(t)?a.aV:t}},21096:function(t,e,r){r.d(e,{C:function(){return a}});class a{overrideNextTransaction(t){this.contractWrapper.withTransactionOverride(t)}constructor(t){this.contractWrapper=t}}},33270:function(t,e,r){r.d(e,{C:function(){return n}});var a=r(21325),i=r(89586);class n{async get(){let[t,e]=await this.contractWrapper.read("getPlatformFeeInfo",[]);return i.bH.parseAsync({platform_fee_recipient:t,platform_fee_basis_points:e})}constructor(t){this.featureName=i.du.name,this.set=(0,a.f)(async t=>{let e=await i.bH.parseAsync(t);return a.T.fromContractWrapper({contractWrapper:this.contractWrapper,method:"setPlatformFeeInfo",args:[e.platform_fee_recipient,e.platform_fee_basis_points]})}),this.contractWrapper=t}}},13957:function(t,e,r){r.d(e,{C:function(){return c}});var a=r(45094),i=r(89586),n=r(13545),o=r(21325),s=r(12158);class c{async getAll(){(0,a.Z)(this.roles.length,"this contract has no support for roles");let t={},e=Object.entries(this.roles);return(await Promise.all(e.map(t=>{let[,e]=t;return this.get(e)}))).forEach((r,a)=>t[e[a][1]]=r),t}async get(t){(0,a.Z)(this.roles.includes(t),'this contract does not support the "'.concat(t,'" role'));let e=this.contractWrapper;if((0,n.h)("getRoleMemberCount",e)&&(0,n.h)("getRoleMember",e)){let r=(0,i.H)(t),a=(await e.read("getRoleMemberCount",[r])).toNumber();return await Promise.all(Array.from(Array(a).keys()).map(t=>e.read("getRoleMember",[r,t])))}throw Error("Contract does not support enumerating roles. Please implement IPermissionsEnumerable to unlock this functionality.")}async verify(t,e){await Promise.all(t.map(async t=>{let[r,a]=await Promise.all([this.get(t),(0,i.aL)(e)]);if(!r.map(t=>t.toLowerCase()).includes(a.toLowerCase()))throw new i.o(a,t)}))}async getRevokeRoleFunctionName(t){let[e,r]=await Promise.all([(0,i.aL)(t),this.contractWrapper.getSignerAddress()]);return r.toLowerCase()===e.toLowerCase()?"renounceRole":"revokeRole"}constructor(t,e){this.featureName=i.d4.name,this.setAll=(0,o.f)(async(t,e)=>{let r=e||await this.contractWrapper.getSignerAddress(),n=new s.C(this.contractWrapper),c=Object.keys(t);(0,a.Z)(c.length,"you must provide at least one role to set"),(0,a.Z)(c.every(t=>this.roles.includes(t)),"this contract does not support the given role");let l=await this.getAll(),d=[],p=c.sort(t=>"admin"===t?1:-1);for(let e=0;e<p.length;e++){var u,h;let a=p[e],[o,s]=await Promise.all([Promise.all((null===(u=t[a])||void 0===u?void 0:u.map(t=>(0,i.aL)(t)))||[]),Promise.all((null===(h=l[a])||void 0===h?void 0:h.map(t=>(0,i.aL)(t)))||[])]),c=o.filter(t=>!s.includes(t)),g=s.filter(t=>!o.includes(t));if(g.length>1){let t=g.indexOf(r);t>-1&&(g.splice(t,1),g.push(r))}c.length&&c.forEach(t=>{d.push(n.encode("grantRole",[(0,i.H)(a),t]))}),g.length&&(await Promise.all(g.map(t=>this.getRevokeRoleFunctionName(t)))).forEach((t,e)=>d.push(n.encode(t,[(0,i.H)(a),g[e]])))}return o.T.fromContractWrapper({contractWrapper:this.contractWrapper,method:"multicall",args:[d]})}),this.grant=(0,o.f)(async(t,e)=>{(0,a.Z)(this.roles.includes(t),'this contract does not support the "'.concat(t,'" role'));let r=await (0,i.aL)(e);return o.T.fromContractWrapper({contractWrapper:this.contractWrapper,method:"grantRole",args:[(0,i.H)(t),r]})}),this.revoke=(0,o.f)(async(t,e)=>{(0,a.Z)(this.roles.includes(t),'this contract does not support the "'.concat(t,'" role'));let r=await (0,i.aL)(e),n=await this.getRevokeRoleFunctionName(r);return o.T.fromContractWrapper({contractWrapper:this.contractWrapper,method:n,args:[(0,i.H)(t),r]})}),this.contractWrapper=t,this.roles=e}}},81517:function(t,e,r){r.r(e),r.d(e,{Marketplace:function(){return T}});var a,i=r(61501),n=r(83531),o=r(73877),s=r(99790),c=r(38),l=r(8400),d=r(45094),p=r(73853),u=r(12158),h=r(89586),g=r(72762),f=r(21325),m=r(13545),w=r(21096),y=r(33270),W=r(13957),v=r(36079),C=r(78680),A=r(15418);let L=((a={})[a.Direct=0]="Direct",a[a.Auction=1]="Auction",a);r(12016),r(98430),r(32942);class P{getAddress(){return this.contractWrapper.address}async getListing(t){let e=await this.contractWrapper.read("listings",[t]);if(e.listingId.toString()!==t.toString())throw new h.L(this.getAddress(),t.toString());if(e.listingType!==L.Auction)throw new h.W(this.getAddress(),t.toString(),"Direct","Auction");return await this.mapListing(e)}async getWinningBid(t){await this.validateListing(i.O$.from(t));let e=await this.contractWrapper.read("winningBid",[t]);if(e.offeror!==n.d)return await (0,g.m)(this.contractWrapper.getProvider(),i.O$.from(t),e)}async getWinner(t){let e=await this.validateListing(i.O$.from(t)),r=await this.contractWrapper.read("winningBid",[t]),a=i.O$.from(Math.floor(Date.now()/1e3)),o=i.O$.from(e.endTimeInEpochSeconds);if(a.gt(o)&&r.offeror!==n.d)return r.offeror;let s=new m.a(this.contractWrapper),c=(await s.getEvents("AuctionClosed")).find(e=>e.data.listingId.eq(i.O$.from(t)));if(!c)throw Error("Could not find auction with listingId ".concat(t," in closed auctions"));return c.data.winningBidder}async getBidBufferBps(){return this.contractWrapper.read("bidBufferBps",[])}async getMinimumNextBid(t){let[e,r,a]=await Promise.all([this.getBidBufferBps(),this.getWinningBid(t),this.validateListing(i.O$.from(t))]),n=r?r.currencyValue.value:a.reservePrice,o=n.add(n.mul(e).div(1e4));return(0,u.a)(this.contractWrapper.getProvider(),a.currencyContractAddress,o)}async validateListing(t){try{return await this.getListing(t)}catch(e){throw console.error("Error getting the listing with id ".concat(t)),e}}async mapListing(t){return{assetContractAddress:t.assetContract,buyoutPrice:i.O$.from(t.buyoutPricePerToken),currencyContractAddress:t.currency,buyoutCurrencyValuePerToken:await (0,u.a)(this.contractWrapper.getProvider(),t.currency,t.buyoutPricePerToken),id:t.listingId.toString(),tokenId:t.tokenId,quantity:t.quantity,startTimeInEpochSeconds:t.startTime,asset:await (0,p.c)(t.assetContract,this.contractWrapper.getProvider(),t.tokenId,this.storage),reservePriceCurrencyValuePerToken:await (0,u.a)(this.contractWrapper.getProvider(),t.currency,t.reservePricePerToken),reservePrice:i.O$.from(t.reservePricePerToken),endTimeInEpochSeconds:t.endTime,sellerAddress:t.tokenOwner,type:L.Auction}}constructor(t,e){this.createListing=(0,f.f)(async t=>{(0,g.v)(t);let e=await (0,h.aL)(t.assetContractAddress),r=await (0,h.aL)(t.currencyContractAddress);await (0,g.h)(this.contractWrapper,this.getAddress(),e,t.tokenId,await this.contractWrapper.getSignerAddress());let a=await (0,C.n)(this.contractWrapper.getProvider(),t.buyoutPricePerToken,r),n=await (0,C.n)(this.contractWrapper.getProvider(),t.reservePricePerToken,r),o=Math.floor(t.startTimestamp.getTime()/1e3),s=(await this.contractWrapper.getProvider().getBlock("latest")).timestamp;o<s&&(o=s);let c=f.T.fromContractWrapper({contractWrapper:this.contractWrapper,method:"createListing",args:[{assetContract:e,tokenId:t.tokenId,buyoutPricePerToken:a,currencyToAccept:(0,v.c)(r),listingType:L.Auction,quantityToList:t.quantity,reservePricePerToken:n,secondsUntilEndTime:t.listingDurationInSeconds,startTime:i.O$.from(o)}],parse:t=>({id:this.contractWrapper.parseLogs("ListingAdded",null==t?void 0:t.logs)[0].args.listingId,receipt:t})});return c.setGasLimitMultiple(1.2),c}),this.createListingsBatch=(0,f.f)(async t=>{let e=(await Promise.all(t.map(t=>this.createListing.prepare(t)))).map(t=>t.encode()),r=f.T.fromContractWrapper({contractWrapper:this.contractWrapper,method:"multicall",args:[e],parse:t=>this.contractWrapper.parseLogs("ListingAdded",null==t?void 0:t.logs).map(e=>({id:e.args.listingId,receipt:t}))});return r.setGasLimitMultiple(1.2),r}),this.buyoutListing=(0,f.f)(async t=>{let e=await this.validateListing(i.O$.from(t)),r=await (0,u.f)(this.contractWrapper.getProvider(),e.currencyContractAddress);return this.makeBid.prepare(t,o.formatUnits(e.buyoutPrice,r.decimals))}),this.makeBid=(0,f.f)(async(t,e)=>{let r=await this.validateListing(i.O$.from(t)),a=await (0,C.n)(this.contractWrapper.getProvider(),e,r.currencyContractAddress);if(a.eq(i.O$.from(0)))throw Error("Cannot make a bid with 0 value");let n=await this.contractWrapper.read("bidBufferBps",[]),o=await this.getWinningBid(t);if(o){let t=(0,g.a)(o.pricePerToken,a,n);(0,d.Z)(t,"Bid price is too low based on the current winning bid and the bid buffer")}else{let t=i.O$.from(r.reservePrice);(0,d.Z)(a.gte(t),"Bid price is too low based on reserve price")}let c=i.O$.from(r.quantity),l=a.mul(c),p=await this.contractWrapper.getCallOverrides()||{};await (0,A.s)(this.contractWrapper,l,r.currencyContractAddress,p);let u=f.T.fromContractWrapper({contractWrapper:this.contractWrapper,method:"offer",args:[t,r.quantity,r.currencyContractAddress,a,s.Bz],overrides:p});return u.setGasLimitMultiple(1.2),u}),this.cancelListing=(0,f.f)(async t=>{let e=await this.validateListing(i.O$.from(t)),r=i.O$.from(Math.floor(Date.now()/1e3)),a=i.O$.from(e.startTimeInEpochSeconds),o=await this.contractWrapper.read("winningBid",[t]);if(r.gt(a)&&o.offeror!==n.d)throw new h.t(t.toString());let s=f.T.fromContractWrapper({contractWrapper:this.contractWrapper,method:"closeAuction",args:[i.O$.from(t),await this.contractWrapper.getSignerAddress()]});return s.setGasLimitMultiple(1.2),s}),this.closeListing=(0,f.f)(async(t,e)=>{e||(e=await this.contractWrapper.getSignerAddress());let r=await this.validateListing(i.O$.from(t));try{let r=f.T.fromContractWrapper({contractWrapper:this.contractWrapper,method:"closeAuction",args:[i.O$.from(t),e]});return r.setGasLimitMultiple(1.2),r}catch(e){if(e.message.includes("cannot close auction before it has ended"))throw new h.w(t.toString(),r.endTimeInEpochSeconds.toString());throw e}}),this.executeSale=(0,f.f)(async t=>{let e=await this.validateListing(i.O$.from(t));try{let r=await this.getWinningBid(t);(0,d.Z)(r,"No winning bid found");let a=this.encoder.encode("closeAuction",[t,e.sellerAddress]),i=this.encoder.encode("closeAuction",[t,r.buyerAddress]),n=f.T.fromContractWrapper({contractWrapper:this.contractWrapper,method:"multicall",args:[a,i]});return n.setGasLimitMultiple(1.2),n}catch(r){if(r.message.includes("cannot close auction before it has ended"))throw new h.w(t.toString(),e.endTimeInEpochSeconds.toString());throw r}}),this.updateListing=(0,f.f)(async t=>{let e=f.T.fromContractWrapper({contractWrapper:this.contractWrapper,method:"updateListing",args:[t.id,t.quantity,t.reservePrice,t.buyoutPrice,t.currencyContractAddress,t.startTimeInEpochSeconds,t.endTimeInEpochSeconds]});return e.setGasLimitMultiple(1.2),e}),this.contractWrapper=t,this.storage=e,this.encoder=new u.C(t)}}class b{getAddress(){return this.contractWrapper.address}async getListing(t){let e=await this.contractWrapper.read("listings",[t]);if(e.assetContract===n.d)throw new h.L(this.getAddress(),t.toString());if(e.listingType!==L.Direct)throw new h.W(this.getAddress(),t.toString(),"Auction","Direct");return await this.mapListing(e)}async getActiveOffer(t,e){await this.validateListing(i.O$.from(t)),(0,d.Z)(c.isAddress(e),"Address must be a valid address");let r=await this.contractWrapper.read("offers",[t,await (0,h.aL)(e)]);if(r.offeror!==n.d)return await (0,g.m)(this.contractWrapper.getProvider(),i.O$.from(t),r)}async validateListing(t){try{return await this.getListing(t)}catch(e){throw console.error("Error getting the listing with id ".concat(t)),e}}async mapListing(t){return{assetContractAddress:t.assetContract,buyoutPrice:i.O$.from(t.buyoutPricePerToken),currencyContractAddress:t.currency,buyoutCurrencyValuePerToken:await (0,u.a)(this.contractWrapper.getProvider(),t.currency,t.buyoutPricePerToken),id:t.listingId.toString(),tokenId:t.tokenId,quantity:t.quantity,startTimeInSeconds:t.startTime,asset:await (0,p.c)(t.assetContract,this.contractWrapper.getProvider(),t.tokenId,this.storage),secondsUntilEnd:t.endTime,sellerAddress:t.tokenOwner,type:L.Direct}}async isStillValidListing(t,e){if(!await (0,g.i)(this.contractWrapper.getProvider(),this.getAddress(),t.assetContractAddress,t.tokenId,t.sellerAddress))return{valid:!1,error:"Token '".concat(t.tokenId,"' from contract '").concat(t.assetContractAddress,"' is not approved for transfer")};let a=this.contractWrapper.getProvider(),i=(await r.e(31787).then(r.t.bind(r,31787,19))).default,n=new l.CH(t.assetContractAddress,i,a),o=await n.supportsInterface(p.I),s=await n.supportsInterface(p.a);if(o){let e;let i=(await Promise.resolve().then(r.t.bind(r,32557,19))).default,n=new l.CH(t.assetContractAddress,i,a);try{e=await n.ownerOf(t.tokenId)}catch(t){}let o=(null==e?void 0:e.toLowerCase())===t.sellerAddress.toLowerCase();return{valid:o,error:o?void 0:"Seller is not the owner of Token '".concat(t.tokenId,"' from contract '").concat(t.assetContractAddress," anymore'")}}if(!s)return{valid:!1,error:"Contract does not implement ERC 1155 or ERC 721."};{let i=(await Promise.resolve().then(r.t.bind(r,10506,19))).default,n=new l.CH(t.assetContractAddress,i,a),o=(await n.balanceOf(t.sellerAddress,t.tokenId)).gte(e||t.quantity);return{valid:o,error:o?void 0:"Seller does not have enough balance of Token '".concat(t.tokenId,"' from contract '").concat(t.assetContractAddress," to fulfill the listing")}}}constructor(t,e){this.createListing=(0,f.f)(async t=>{(0,g.v)(t);let e=await (0,h.aL)(t.assetContractAddress),r=await (0,h.aL)(t.currencyContractAddress);await (0,g.h)(this.contractWrapper,this.getAddress(),e,t.tokenId,await this.contractWrapper.getSignerAddress());let a=await (0,C.n)(this.contractWrapper.getProvider(),t.buyoutPricePerToken,r),n=Math.floor(t.startTimestamp.getTime()/1e3),o=(await this.contractWrapper.getProvider().getBlock("latest")).timestamp;n<o&&(n=o);let s=f.T.fromContractWrapper({contractWrapper:this.contractWrapper,method:"createListing",args:[{assetContract:e,tokenId:t.tokenId,buyoutPricePerToken:a,currencyToAccept:(0,v.c)(r),listingType:L.Direct,quantityToList:t.quantity,reservePricePerToken:a,secondsUntilEndTime:t.listingDurationInSeconds,startTime:i.O$.from(n)}],parse:t=>({id:this.contractWrapper.parseLogs("ListingAdded",null==t?void 0:t.logs)[0].args.listingId,receipt:t})});return s.setGasLimitMultiple(1.2),s}),this.createListingsBatch=(0,f.f)(async t=>{let e=(await Promise.all(t.map(t=>this.createListing.prepare(t)))).map(t=>t.encode()),r=f.T.fromContractWrapper({contractWrapper:this.contractWrapper,method:"multicall",args:[e],parse:t=>this.contractWrapper.parseLogs("ListingAdded",null==t?void 0:t.logs).map(e=>({id:e.args.listingId,receipt:t}))});return r.setGasLimitMultiple(1.2),r}),this.makeOffer=(0,f.f)(async(t,e,r,a,n)=>{if((0,u.i)(r))throw Error("You must use the wrapped native token address when making an offer with a native token");let o=await (0,C.n)(this.contractWrapper.getProvider(),a,r);try{await this.getListing(t)}catch(e){throw console.error("Failed to get listing, err =",e),Error("Error getting the listing with id ".concat(t))}let c=i.O$.from(e),l=i.O$.from(o).mul(c),d=await this.contractWrapper.getCallOverrides()||{};await (0,A.s)(this.contractWrapper,l,r,d);let p=s.Bz;n&&(p=i.O$.from(Math.floor(n.getTime()/1e3)));let h=f.T.fromContractWrapper({contractWrapper:this.contractWrapper,method:"offer",args:[t,e,r,o,p],overrides:d});return h.setGasLimitMultiple(1.2),h}),this.acceptOffer=(0,f.f)(async(t,e)=>{await this.validateListing(i.O$.from(t));let r=await (0,h.aL)(e),a=await this.contractWrapper.read("offers",[t,r]),n=f.T.fromContractWrapper({contractWrapper:this.contractWrapper,method:"acceptOffer",args:[t,r,a.currency,a.pricePerToken]});return n.setGasLimitMultiple(1.2),n}),this.buyoutListing=(0,f.f)(async(t,e,r)=>{let a=await this.validateListing(i.O$.from(t)),{valid:n,error:o}=await this.isStillValidListing(a,e);if(!n)throw Error("Listing ".concat(t," is no longer valid. ").concat(o));let s=r||await this.contractWrapper.getSignerAddress(),c=i.O$.from(e),l=i.O$.from(a.buyoutPrice).mul(c),d=await this.contractWrapper.getCallOverrides()||{};await (0,A.s)(this.contractWrapper,l,a.currencyContractAddress,d);let p=f.T.fromContractWrapper({contractWrapper:this.contractWrapper,method:"buy",args:[t,s,c,a.currencyContractAddress,l],overrides:d});return p.setGasLimitMultiple(1.2),p}),this.updateListing=(0,f.f)(async t=>{let e=f.T.fromContractWrapper({contractWrapper:this.contractWrapper,method:"updateListing",args:[t.id,t.quantity,t.buyoutPrice,t.buyoutPrice,await (0,h.aL)(t.currencyContractAddress),t.startTimeInSeconds,t.secondsUntilEnd]});return e.setGasLimitMultiple(1.2),e}),this.cancelListing=(0,f.f)(async t=>{let e=f.T.fromContractWrapper({contractWrapper:this.contractWrapper,method:"cancelDirectListing",args:[t]});return e.setGasLimitMultiple(1.2),e}),this.contractWrapper=t,this.storage=e}}class T{get chainId(){return this._chainId}onNetworkUpdated(t){this.contractWrapper.updateSignerOrProvider(t)}getAddress(){return this.contractWrapper.address}async getListing(t){let e=await this.contractWrapper.read("listings",[t]);if(e.assetContract===n.d)throw new h.L(this.getAddress(),t.toString());switch(e.listingType){case L.Auction:return await this.auction.mapListing(e);case L.Direct:return await this.direct.mapListing(e);default:throw Error("Unknown listing type: ".concat(e.listingType))}}async getActiveListings(t){let e=await this.getAllListingsNoFilter(!0),r=this.applyFilter(e,t),a=i.O$.from(Math.floor(Date.now()/1e3));return r.filter(t=>t.type===L.Auction&&i.O$.from(t.endTimeInEpochSeconds).gt(a)&&i.O$.from(t.startTimeInEpochSeconds).lte(a)||t.type===L.Direct&&i.O$.from(t.quantity).gt(0))}async getAllListings(t){let e=await this.getAllListingsNoFilter(!1);return this.applyFilter(e,t)}async getTotalCount(){return await this.contractWrapper.read("totalListings",[])}async isRestrictedToListerRoleOnly(){return!await this.contractWrapper.read("hasRole",[(0,h.H)("lister"),n.d])}async getBidBufferBps(){return this.contractWrapper.read("bidBufferBps",[])}async getTimeBufferInSeconds(){return this.contractWrapper.read("timeBuffer",[])}async getOffers(t){let e=await this.events.getEvents("NewOffer",{order:"desc",filters:{listingId:t}});return await Promise.all(e.map(e=>(0,g.m)(this.contractWrapper.getProvider(),i.O$.from(t),{quantityWanted:e.data.quantityWanted,pricePerToken:e.data.quantityWanted.gt(0)?e.data.totalOfferAmount.div(e.data.quantityWanted):e.data.totalOfferAmount,currency:e.data.currency,offeror:e.data.offeror})))}async getAllListingsNoFilter(t){return(await Promise.all(Array.from(Array((await this.contractWrapper.read("totalListings",[])).toNumber()).keys()).map(async e=>{let r;try{r=await this.getListing(e)}catch(t){if(t instanceof h.L)return;console.warn("Failed to get listing ".concat(e,"' - skipping. Try 'marketplace.getListing(").concat(e,")' to get the underlying error."));return}if(r.type===L.Auction)return r;if(t){let{valid:t}=await this.direct.isStillValidListing(r);if(!t)return}return r}))).filter(t=>void 0!==t)}applyFilter(t,e){let r=[...t],a=i.O$.from((null==e?void 0:e.start)||0).toNumber(),n=i.O$.from((null==e?void 0:e.count)||p.D).toNumber();return e&&(e.seller&&(r=r.filter(t=>{var r;return t.sellerAddress.toString().toLowerCase()===(null==e?void 0:null===(r=e.seller)||void 0===r?void 0:r.toString().toLowerCase())})),e.tokenContract&&(r=r.filter(t=>{var r;return t.assetContractAddress.toString().toLowerCase()===(null==e?void 0:null===(r=e.tokenContract)||void 0===r?void 0:r.toString().toLowerCase())})),void 0!==e.tokenId&&(r=r.filter(t=>{var r;return t.tokenId.toString()===(null==e?void 0:null===(r=e.tokenId)||void 0===r?void 0:r.toString())})),r=(r=r.filter((t,e)=>e>=a)).slice(0,n)),r}async prepare(t,e,r){return f.T.fromContractWrapper({contractWrapper:this.contractWrapper,method:t,args:e,overrides:r})}async call(t,e,r){return this.contractWrapper.call(t,e,r)}constructor(t,e,r){this.getAll=this.getAllListings,this.buyoutListing=(0,f.f)(async(t,e,r)=>{let a=await this.contractWrapper.read("listings",[t]);if(a.listingId.toString()!==t.toString())throw new h.L(this.getAddress(),t.toString());switch(a.listingType){case L.Direct:return(0,d.Z)(void 0!==e,"quantityDesired is required when buying out a direct listing"),await this.direct.buyoutListing.prepare(t,e,r);case L.Auction:return await this.auction.buyoutListing.prepare(t);default:throw Error("Unknown listing type: ".concat(a.listingType))}}),this.makeOffer=(0,f.f)(async(t,e,r)=>{let a=await this.contractWrapper.read("listings",[t]);if(a.listingId.toString()!==t.toString())throw new h.L(this.getAddress(),t.toString());let i=await this.contractWrapper.getChainID();switch(a.listingType){case L.Direct:return(0,d.Z)(r,"quantity is required when making an offer on a direct listing"),await this.direct.makeOffer.prepare(t,r,(0,u.i)(a.currency)?h.aW[i].wrapped.address:a.currency,e);case L.Auction:return await this.auction.makeBid.prepare(t,e);default:throw Error("Unknown listing type: ".concat(a.listingType))}}),this.setBidBufferBps=(0,f.f)(async t=>{await this.roles.verify(["admin"],await this.contractWrapper.getSignerAddress());let e=await this.getTimeBufferInSeconds();return f.T.fromContractWrapper({contractWrapper:this.contractWrapper,method:"setAuctionBuffers",args:[e,i.O$.from(t)]})}),this.setTimeBufferInSeconds=(0,f.f)(async t=>{await this.roles.verify(["admin"],await this.contractWrapper.getSignerAddress());let e=await this.getBidBufferBps();return f.T.fromContractWrapper({contractWrapper:this.contractWrapper,method:"setAuctionBuffers",args:[i.O$.from(t),e]})}),this.allowListingFromSpecificAssetOnly=(0,f.f)(async t=>{let e=[];return(await this.roles.get("asset")).includes(n.d)&&e.push(this.encoder.encode("revokeRole",[(0,h.H)("asset"),n.d])),e.push(this.encoder.encode("grantRole",[(0,h.H)("asset"),t])),f.T.fromContractWrapper({contractWrapper:this.contractWrapper,method:"multicall",args:[e]})}),this.allowListingFromAnyAsset=(0,f.f)(async()=>{let t=[],e=await this.roles.get("asset");for(let r in e)t.push(this.encoder.encode("revokeRole",[(0,h.H)("asset"),r]));return t.push(this.encoder.encode("grantRole",[(0,h.H)("asset"),n.d])),f.T.fromContractWrapper({contractWrapper:this.contractWrapper,method:"multicall",args:[t]})});let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=arguments.length>4?arguments[4]:void 0,s=arguments.length>5?arguments[5]:void 0,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:new h.cs(t,e,o,a,r);this._chainId=s,this.abi=h.bj.parse(o||[]),this.contractWrapper=c,this.storage=r,this.metadata=new m.C(this.contractWrapper,h.b$,this.storage),this.app=new m.b(this.contractWrapper,this.metadata,this.storage),this.roles=new W.C(this.contractWrapper,T.contractRoles),this.encoder=new u.C(this.contractWrapper),this.estimator=new m.G(this.contractWrapper),this.direct=new b(this.contractWrapper,this.storage),this.auction=new P(this.contractWrapper,this.storage),this.events=new m.a(this.contractWrapper),this.platformFees=new y.C(this.contractWrapper),this.interceptor=new w.C(this.contractWrapper)}}T.contractRoles=h.dH},72762:function(t,e,r){r.d(e,{a:function(){return h},g:function(){return g},h:function(){return d},i:function(){return l},m:function(){return u},v:function(){return p}});var a=r(8400),i=r(61501),n=r(45094),o=r(73853),s=r(89586),c=r(12158);async function l(t,e,i,n,s){try{let c=(await r.e(31787).then(r.t.bind(r,31787,19))).default,l=new a.CH(i,c,t),[d,p]=await Promise.all([l.supportsInterface(o.I),l.supportsInterface(o.a)]);if(d){let o;let c=(await Promise.resolve().then(r.t.bind(r,32557,19))).default,l=new a.CH(i,c,t);if(await l.isApprovedForAll(s,e))return!0;try{o=await l.getApproved(n)}catch(t){}return(null==o?void 0:o.toLowerCase())===e.toLowerCase()}if(!p)return console.error("Contract does not implement ERC 1155 or ERC 721."),!1;{let n=(await Promise.resolve().then(r.t.bind(r,10506,19))).default,o=new a.CH(i,n,t);return await o.isApprovedForAll(s,e)}}catch(t){return console.error("Failed to check if token is approved",t),!1}}async function d(t,e,a,i,n){let c=(await r.e(31787).then(r.t.bind(r,31787,19))).default,l=new s.cs(t.getSignerOrProvider(),a,c,t.options,t.storage),[d,p]=await Promise.all([l.read("supportsInterface",[o.I]),l.read("supportsInterface",[o.a])]);if(d){let o=(await Promise.resolve().then(r.t.bind(r,32557,19))).default,c=new s.cs(t.getSignerOrProvider(),a,o,t.options,t.storage);await c.read("isApprovedForAll",[n,e])||(await c.read("getApproved",[i])).toLowerCase()===e.toLowerCase()||await c.sendTransaction("setApprovalForAll",[e,!0])}else if(p){let i=(await Promise.resolve().then(r.t.bind(r,10506,19))).default,o=new s.cs(t.getSignerOrProvider(),a,i,t.options,t.storage);await o.read("isApprovedForAll",[n,e])||await o.sendTransaction("setApprovalForAll",[e,!0])}else throw Error("Contract must implement ERC 1155 or ERC 721.")}function p(t){(0,n.Z)(void 0!==t.assetContractAddress&&null!==t.assetContractAddress,"Asset contract address is required"),(0,n.Z)(void 0!==t.buyoutPricePerToken&&null!==t.buyoutPricePerToken,"Buyout price is required"),(0,n.Z)(void 0!==t.listingDurationInSeconds&&null!==t.listingDurationInSeconds,"Listing duration is required"),(0,n.Z)(void 0!==t.startTimestamp&&null!==t.startTimestamp,"Start time is required"),(0,n.Z)(void 0!==t.tokenId&&null!==t.tokenId,"Token ID is required"),(0,n.Z)(void 0!==t.quantity&&null!==t.quantity,"Quantity is required"),"NewAuctionListing"===t.type&&(0,n.Z)(void 0!==t.reservePricePerToken&&null!==t.reservePricePerToken,"Reserve price is required")}async function u(t,e,r){return{quantity:r.quantityDesired,pricePerToken:r.pricePerToken,currencyContractAddress:r.currency,buyerAddress:r.offeror,quantityDesired:r.quantityWanted,currencyValue:await (0,c.a)(t,r.currency,r.quantityWanted.mul(r.pricePerToken)),listingId:e}}function h(t,e,r){return r=i.O$.from(r),t=i.O$.from(t),e=i.O$.from(e),!t.eq(i.O$.from(0))&&e.sub(t).mul(s.dE).div(t).gte(r)}async function g(t,e,r){let a=[];for(;e-t>o.D;)a.push(r(t,t+o.D-1)),t+=o.D;return a.push(r(t,e-1)),await Promise.all(a)}},15418:function(t,e,r){r.d(e,{B:function(){return c},C:function(){return l},N:function(){return d},a:function(){return p},s:function(){return u}});var a=r(89586),i=r(30248),n=r(12158);let o=i.z.object({}).catchall(i.z.union([a.cx,i.z.unknown()])),s=i.z.union([i.z.array(i.z.array(o)).transform(t=>t.flat()),i.z.array(o),o]).optional().nullable(),c=i.z.object({name:i.z.union([i.z.string(),i.z.number()]).optional().nullable(),description:i.z.string().nullable().optional().nullable(),image:a.cy.nullable().optional(),animation_url:a.cy.optional().nullable()}),l=c.extend({external_url:a.cy.nullable().optional(),background_color:a.cz.optional().nullable(),properties:s,attributes:s}).catchall(i.z.union([a.cx,i.z.unknown()])),d=i.z.union([l,i.z.string()]),p=l.extend({id:i.z.string(),uri:i.z.string(),image:i.z.string().nullable().optional(),external_url:i.z.string().nullable().optional(),animation_url:i.z.string().nullable().optional()});async function u(t,e,i,o){if((0,n.i)(i))o.value=e;else{let n=(await Promise.resolve().then(r.t.bind(r,54497,19))).default,s=t.getSigner(),c=t.getProvider(),l=new a.cs(s||c,i,n,t.options,t.storage),d=await t.getSignerAddress(),p=t.address;return(await l.read("allowance",[d,p])).lt(e)&&await l.sendTransaction("approve",[p,e]),o}}}}]);