"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[13545],{13545:function(t,r,e){e.d(r,{C:function(){return p},G:function(){return l},a:function(){return h},b:function(){return d},d:function(){return o},h:function(){return i}});var a=e(89586),n=e(21325),s=e(73877),c=e(75781);function o(t,r){return(0,a.ai)(t.abi,r,t.extensions)}function i(t,r){return t in r.readContract.functions}class p{parseOutputMetadata(t){return this.schema.output.parseAsync(t)}parseInputMetadata(t){return this.schema.input.parseAsync(t)}async get(){let t;if(this.supportsContractMetadata(this.contractWrapper)){let r=await this.contractWrapper.read("contractURI",[]);r&&r.includes("://")&&(t=await this.storage.downloadJSON(r))}if(!t)try{let r,e,n;try{i("name",this.contractWrapper)&&(r=await this.contractWrapper.read("name",[]))}catch(t){}try{i("symbol",this.contractWrapper)&&(e=await this.contractWrapper.read("symbol",[]))}catch(t){}try{n=await (0,a.K)(this.contractWrapper.address,this.contractWrapper.getProvider(),this.storage,this.contractWrapper.options)}catch(t){}t={name:r||(null==n?void 0:n.name),symbol:e,description:null==n?void 0:n.info.title}}catch(t){throw Error("Could not fetch contract metadata")}return this.parseOutputMetadata(t)}async _parseAndUploadMetadata(t){let r=await this.parseInputMetadata(t);return this.storage.upload(r)}supportsContractMetadata(t){return o(t,"ContractMetadata")}constructor(t,r,e){this.featureName=a.cJ.name,this.set=(0,n.f)(async t=>{let r=await this._parseAndUploadMetadata(t),e=this.contractWrapper;if(this.supportsContractMetadata(e))return n.T.fromContractWrapper({contractWrapper:this.contractWrapper,method:"setContractURI",args:[r],parse:t=>({receipt:t,data:this.get})});throw new a.x(a.cJ)}),this.update=(0,n.f)(async t=>await this.set.prepare({...await this.get(),...t})),this.contractWrapper=t,this.schema=r,this.storage=e}}class h{addTransactionListener(t){this.contractWrapper.addListener(a.aZ.Transaction,t)}removeTransactionListener(t){this.contractWrapper.off(a.aZ.Transaction,t)}addEventListener(t,r){let e=this.contractWrapper.readContract.interface.getEvent(t),a={address:this.contractWrapper.address,topics:[this.contractWrapper.readContract.interface.getEventTopic(e)]},n=t=>{let e=this.contractWrapper.readContract.interface.parseLog(t);r(this.toContractEvent(e.eventFragment,e.args,t))};return this.contractWrapper.getProvider().on(a,n),()=>{this.contractWrapper.getProvider().off(a,n)}}listenToAllEvents(t){let r={address:this.contractWrapper.address},e=r=>{try{let e=this.contractWrapper.readContract.interface.parseLog(r);t(this.toContractEvent(e.eventFragment,e.args,r))}catch(t){console.error("Could not parse event:",r,t)}};return this.contractWrapper.getProvider().on(r,e),()=>{this.contractWrapper.getProvider().off(r,e)}}removeEventListener(t,r){let e=this.contractWrapper.readContract.interface.getEvent(t);this.contractWrapper.readContract.off(e.name,r)}removeAllListeners(){this.contractWrapper.readContract.removeAllListeners();let t=this.contractWrapper.address;this.contractWrapper.getProvider().removeAllListeners({address:t})}async getAllEvents(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{fromBlock:0,toBlock:"latest",order:"desc"},r=(await this.contractWrapper.readContract.queryFilter({},t.fromBlock,t.toBlock)).sort((r,e)=>"desc"===t.order?e.blockNumber-r.blockNumber:r.blockNumber-e.blockNumber);return this.parseEvents(r)}async getEvents(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{fromBlock:0,toBlock:"latest",order:"desc"},e=this.contractWrapper.readContract.interface.getEvent(t),a=r.filters?e.inputs.map(t=>r.filters[t.name]):[],n=this.contractWrapper.readContract.filters[e.name](...a),s=(await this.contractWrapper.readContract.queryFilter(n,r.fromBlock,r.toBlock)).sort((t,e)=>"desc"===r.order?e.blockNumber-t.blockNumber:t.blockNumber-e.blockNumber);return this.parseEvents(s)}parseEvents(t){return t.map(t=>{let r=Object.fromEntries(Object.entries(t).filter(t=>"function"!=typeof t[1]&&"args"!==t[0]));if(t.args){let e=Object.entries(t.args),a=e.slice(e.length/2,e.length),n={};for(let[t,r]of a)n[t]=r;return{eventName:t.event||"",data:n,transaction:r}}return{eventName:t.event||"",data:{},transaction:r}})}toContractEvent(t,r,e){let a=Object.fromEntries(Object.entries(e).filter(t=>"function"!=typeof t[1]&&"args"!==t[0])),n={};return t.inputs.forEach((t,e)=>{if(Array.isArray(r[e])){let a=t.components;if(a){let s=r[e];if("tuple[]"===t.type){let r=[];for(let t=0;t<s.length;t++){let e=s[t],n={};for(let t=0;t<a.length;t++)n[a[t].name]=e[t];r.push(n)}n[t.name]=r}else{let r={};for(let t=0;t<a.length;t++)r[a[t].name]=s[t];n[t.name]=r}}}else n[t.name]=r[e]}),{eventName:t.name,data:n,transaction:a}}constructor(t){this.contractWrapper=t}}class l{async gasCostOf(t,r){var e;return e=await (0,n.c)(this.contractWrapper.getProvider(),await this.contractWrapper.populateTransaction(t,r)),s.formatEther(e)}async gasLimitOf(t,r){return this.contractWrapper.estimateGas(t,r)}async currentGasPriceInGwei(){let t=await this.contractWrapper.getProvider().getGasPrice();return s.formatUnits(t,"gwei")}constructor(t){this.contractWrapper=t}}class d{async get(){return o(this.contractWrapper,"AppURI")?await this.contractWrapper.read("appURI",[]):(0,c.ov)((await this.metadata.get()).app_uri||"",this.storage.getGatewayUrls())}constructor(t,r,e){this.featureName=a.cK.name,this.set=(0,n.f)(async t=>o(this.contractWrapper,"AppURI")?n.T.fromContractWrapper({contractWrapper:this.contractWrapper,method:"setAppURI",args:[t]}):await this.metadata.update.prepare({app_uri:t})),this.contractWrapper=t,this.metadata=r,this.storage=e}}}}]);